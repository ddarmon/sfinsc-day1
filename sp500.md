# S&P 500 Correlation Networks

## The Data

![Demo stock data](https://raw.githubusercontent.com/ddarmon/sfinsc-day1/master/graphics/demo-gephi-workspace.png)

The data consists of the closing prices of the XYZ companies in the S&P 500 from XYZ to XYZ and from XYZ to XYZ. For each company, we compute the log returns for their stock. For example, here are the log returns from 

<p align="center">
<img src="https://raw.githubusercontent.com/ddarmon/sfinsc-day1/master/graphics/stocks-raw-max-corr.png">
</p>

<p align="center">
<img src="https://raw.githubusercontent.com/ddarmon/sfinsc-day1/master/graphics/stocks-logreturn-max-corr.png">
</p>

<p align="center">
<img src="https://raw.githubusercontent.com/ddarmon/sfinsc-day1/master/graphics/stocks-corrplot-max-corr.png">
</p>

> **Exercise:**

## Data Cleaning

We will be investigating networks constructed via pairwise correlations between the log returns of each company in the data set. Correlations can be very sensitive to outliers in a data set, and thus we first [Winsorize](https://en.wikipedia.org/wiki/Winsorizing) the log return time series for each company before computing correlations.

Many statistical procedures have assumptions 

> **Exercise:** Load the correlation network ``sp500_network.txt`` into Gephi as an undirected, weighted network where the weight on an edge between two companies corresponds to their correlation over the XYZ year period.

> **Exercise:** Copy over the company names as the labels for the nodes.

## Network Construction

The network itself is stored in ``sp500_network.txt`` as an annotated edge list, for example line 2

> A,AAP,Undirected,0.376600

says that there is an undirected edge between A (Agilent Technologies)  and AAP (Advance Auto Parts), and the pairwise correlation between their log stock returns was 0.376600.

> **Exercise:** Load the network into gephi by going to File > Import spreadsheet... PUT INFO / FIGURES HERE ON HOW TO SET THE OPTIONS FOR IMPORTING THE NETWORK.

## Network Analysis

Because there is an edge between each node in the network (we have computed a pairwise correlation between each pair of log returns), the network is dense: for 434 nodes, there are the full 93961 edges possible.

> **Exercise**: How do you determine the number of edges in an N node network? Hint: count the number of ways to pair each node with one of the other nodes, and account for duplicates from overcounting A -- B and B -- A.

So a first step in working with this data is to use Gephi's filtering capabilities. Gephi can filter on node or edge attributes. In this case, we would like to filter out the edges corresponding to weaker correlations in the network.

## Using a Statistical Model &mdash; The Gaussian Graphical Model and the GLASSO

In your explorations, you have constructed a sequence of networks with varying strengths of correlations between the stocks. You may have noticed that a lot of the stocks are highly correlated: this is to be expected, since we know that the market tends to move together. However, we also expect to find clusters of stocks that move together more similarly than others, for example stocks in the auto industry, or in the financial sector.

One way to investigate this type of behavior is by introducing a statistical model that tries to capture these relationships. One such model...